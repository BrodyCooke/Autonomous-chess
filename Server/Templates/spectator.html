<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game spectator
    </title>
    <style>
        .chess-board { border-spacing: 0; border-collapse: collapse; }
        .chess-board th { padding: .5em; }
        .chess-board th + th { border-bottom: 1px solid #000; }
        .chess-board th:first-child,
        .chess-board td:last-child { border-right: 1px solid #000; }
        .chess-board tr:last-child td { border-bottom: 1px solid; }
        .chess-board th:empty { border: none; }
        .chess-board td { width: 1.5em; height: 1.5em; text-align: center; font-size: 44px; line-height: 0;}
        .chess-board .light { background: #eee; width: 100px; height: 90px; font-size: 44px; }
        .chess-board .dark { background: #aaa; width: 100px; height: 90px; font-size: 44px; }
    </style>
</head>
<body>

<table class="chess-board">
    <tr>
        <th></th>
        <th>a</th>
        <th>b</th>
        <th>c</th>
        <th>d</th>
        <th>e</th>
        <th>f</th>
        <th>g</th>
        <th>h</th>
    <tr>
        <th>8</th>
        <td><button id="57" class="light" onclick="setButton(this)">♜</button></td>
        <td><button id="58" class="dark" onclick="setButton(this)">♞</button></td>
        <td><button id="59" class="light" onclick="setButton(this)">♝</button></td>
        <td><button id="60" class="dark" onclick="setButton(this)">♛</button></td>
        <td><button id="61" class="light" onclick="setButton(this)">♚</button></td>
        <td><button id="62" class="dark" onclick="setButton(this)">♝</button></td>
        <td><button id="63" class="light" onclick="setButton(this)">♞</button></td>
        <td><button id="64" class="dark" onclick="setButton(this)">♜</button></td>
    </tr>
    <tr>
        <th>7</th>
        <td><button id="49" class="dark" onclick="setButton(this)">♟</button></td>
        <td><button id="50" class="light" onclick="setButton(this)">♟</button></td>
        <td><button id="51" class="dark" onclick="setButton(this)">♟</button></td>
        <td><button id="52" class="light" onclick="setButton(this)">♟</button></td>
        <td><button id="53" class="dark" onclick="setButton(this)">♟</button></td>
        <td><button id="54" class="light" onclick="setButton(this)">♟</button></td>
        <td><button id="55" class="dark" onclick="setButton(this)">♟</button></td>
        <td><button id="56" class="light" onclick="setButton(this)">♟</button></td>
    </tr>
    <tr>
        <th>6</th>
        <td><button id="41" class="light" onclick="setButton(this)"></button></td>
        <td><button id="42" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="43" class="light" onclick="setButton(this)"></button></td>
        <td><button id="44" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="45" class="light" onclick="setButton(this)"></button></td>
        <td><button id="46" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="47" class="light" onclick="setButton(this)"></button></td>
        <td><button id="48" class="dark" onclick="setButton(this)"></button></td>
    </tr>
    <tr>
        <th>5</th>
        <td><button id="33" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="34" class="light" onclick="setButton(this)"></button></td>
        <td><button id="35" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="36" class="light" onclick="setButton(this)"></button></td>
        <td><button id="37" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="38" class="light" onclick="setButton(this)"></button></td>
        <td><button id="39" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="40" class="light" onclick="setButton(this)"></button></td>
    </tr>
    <tr>
        <th>4</th>
        <td><button id="25" class="light" onclick="setButton(this)"></button></td>
        <td><button id="26" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="27" class="light" onclick="setButton(this)"></button></td>
        <td><button id="28" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="29" class="light" onclick="setButton(this)"></button></td>
        <td><button id="30" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="31" class="light" onclick="setButton(this)"></button></td>
        <td><button id="32" class="dark" onclick="setButton(this)"></button></td>
    </tr>
    <tr>
        <th>3</th>
        <td><button id="17" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="18" class="light" onclick="setButton(this)"></button></td>
        <td><button id="19" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="20" class="light" onclick="setButton(this)"></button></td>
        <td><button id="21" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="22" class="light" onclick="setButton(this)"></button></td>
        <td><button id="23" class="dark" onclick="setButton(this)"></button></td>
        <td><button id="24" class="light" onclick="setButton(this)"></button></td>
    </tr>
    <tr>
        <th>2</th>
        <td><button id="9" class="light" onclick="setButton(this)">♙</button></td>
        <td><button id="10" class="dark" onclick="setButton(this)">♙</button></td>
        <td><button id="11" class="light" onclick="setButton(this)">♙</button></td>
        <td><button id="12" class="dark" onclick="setButton(this)">♙</button></td>
        <td><button id="13" class="light" onclick="setButton(this)">♙</button></td>
        <td><button id="14" class="dark" onclick="setButton(this)">♙</button></td>
        <td><button id="15" class="light" onclick="setButton(this)">♙</button></td>
        <td><button id="16" class="dark" onclick="setButton(this)">♙</button></td>
    </tr>
    <tr>
        <th>1</th>
        <td><button id="1" class="dark" onclick="setButton(this)">♖</button></td>
        <td><button id="2" class="light" onclick="setButton(this)">♘</button></td>
        <td><button id="3" class="dark" onclick="setButton(this)">♗</button></td>
        <td><button id="4" class="light" onclick="setButton(this)">♕</button></td>
        <td><button id="5" class="dark" onclick="setButton(this)">♔</button></td>
        <td><button id="6" class="light" onclick="setButton(this)">♗</button></td>
        <td><button id="7" class="dark" onclick="setButton(this)">♘</button></td>
        <td><button id="8" class="light" onclick="setButton(this)">♖</button></td>
    </tr>
    
</table>

<button id="buttonstart" style= "width: 200px; height: 90px; font-size: 44px;" onclick="setButton2(this)">Start</button>
<button id="buttonendgame" style= "width: 200px; height: 90px; font-size: 44px;" onclick="setButton3(this)">End</button>
<button id="buttonTurn" style= "width: 200px; height: 90px; font-size: 30px;" onclick="setButton3(this)">Turn: White</button>
<button id="check_white" style= "width: 200px; height: 90px; font-size: 30px;" onclick="setButton3(this)">Check w: 0</button>
<button id="check_black" style= "width: 200px; height: 90px; font-size: 30px;" onclick="setButton3(this)">Check b: 0</button>


<script>
    var previous_move = []
    waitForServer();
    function ReceiveMoveFromServer() {
        fetch('/spectator')
        .then(response => response.json())
        .then(data => {
            //console.log('Server response:', data);
            response = data['message'];
            console.log(response)
        })
        .catch(error => {
            console.error('Error fetching status:', error);
        });
    }

    function waitForServer(){
        response = []
        console.log("wiating for server")
        var intervalId = window.setInterval(function(){
        // call your function here
        ReceiveMoveFromServer()
        if (response.length !== previous_move.length && typeof response !== 'undefined'){
            
            for (var i = previous_move.length; i < response.length; i++) {
                temp = translate_fromUCI(response[i])
                response_list = temp.split(' ')
                from = response_list[0]
                to = response_list[1]

                document.getElementById(to).textContent = document.getElementById(from).textContent;
                document.getElementById(from).textContent = ''
            }
            previous_move = response;
            }
        }, 2000);       
    }

    function getColor(piece){
        color = ''
        if (piece == '♙' || piece == '♖' || piece == '♘' || piece == '♗' || piece == '♕'  || piece == '♔'){
            color = 'white';
        }
        else{color = 'black';}
        return color;
    }

    function translate_fromUCI(UCImove) {
        move = ''
        // remove spaces

        if(UCImove == 'e1h1' && document.getElementById(5) == '♔'){
            document.getElementById(6).textContent = document.getElementById(8).textContent;
            document.getElementById(8).textContent = '';
            move = '5 7';
            return move;}
        else if(UCImove == 'e1a1' && document.getElementById(5) == '♔'){
            document.getElementById(4).textContent = document.getElementById(1).textContent;
            document.getElementById(1).textContent = '';
            move = '5 3';
            return move;}
        else if(UCImove == 'e8h8' && document.getElementById(5) == '♚'){
            document.getElementById(62).textContent = document.getElementById(64).textContent;
            document.getElementById(64).textContent = '';
            move = '61 63';
            return move;}
        else if(UCImove == 'e8a8' && document.getElementById(5) == '♚'){
            document.getElementById(60).textContent = document.getElementById(57).textContent;
            document.getElementById(57).textContent = '';
            move = '61 59';
            return move;}

        UCImove = UCImove.replace(/\s/g, '');
        UCImove_list = UCImove.split('')

        from_row = UCImove_list[1]
        from_col = UCImove_list[0]

        to_row = UCImove_list[3]
        to_col = UCImove_list[2]

        from_col = from_col.charCodeAt(0) - 96;
        to_col =  to_col.charCodeAt(0) - 96;

        from_row = (from_row - 1) * 8
        to_row = (to_row - 1) * 8

        from = from_col + from_row
        to = to_col + to_row

        move = from + ' ' + to
        console.log(move)

        if(UCImove.length == 5){
            promation_type = UCImove_list[4];
            from_color = getColor(document.getElementById(from).textContent)
            if(from_color == 'white' && promation_type == 'q'){document.getElementById(from).textContent = '♕';}
            else if(from_color == 'black' && promation_type == 'q'){document.getElementById(from).textContent = '♛';}
            else if(from_color == 'white' && promation_type == 'r'){document.getElementById(from).textContent = '♖';}
            else if(from_color == 'black' && promation_type == 'r'){document.getElementById(from).textContent = '♜';}
            else if(from_color == 'white' && promation_type == 'b'){document.getElementById(from).textContent = '♗';}
            else if(from_color == 'black' && promation_type == 'b'){document.getElementById(from).textContent = '♝';}
            else if(from_color == 'white' && promation_type == 'k'){document.getElementById(from).textContent = '♘';}
            else if(from_color == 'black' && promation_type == 'k'){document.getElementById(from).textContent = '♞';}
        }

        return move
    }


</script>

</body>
</html>
